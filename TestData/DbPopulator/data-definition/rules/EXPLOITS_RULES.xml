<Rules>

  <Rule group="PH_SYS_RULE_Exploits" id="PH_Rule_Web_Server_1" phIncidentCategory="Application">
    <Name>Excessive HTTP Client Side Errors</Name>
    <active>true</active>
    <Description> Detects multiple HTTP client side errors from the same IP - might indicate an attack . Thresholds are 5 errors from the samesrc IP within a 10 minute interval</Description>
    <CustomerScope groupByEachCustomer="true"> <Include all="true"/> <Exclude/> </CustomerScope>
    <IncidentDef eventType="PH_RULE_EXCESS_HTTP_CLIENT_ERR" severity="9">
      <ArgList>
        srcIpAddr = ExcessHTTPClientErr.srcIpAddr, destIpAddr = ExcessHTTPClientErr.reptDevIpAddr,incidentCount = ExcessHTTPClientErr.COUNT(*)
      </ArgList>
    </IncidentDef>
    <PatternClause window="600">
       <SubPattern displayName="ExcessHTTPClientErr" name="ExcessHTTPClientErr">
         <SingleEvtConstr> eventType IN ("IIS-Web-Forbidden-Access-Denied","IIS-Web-Bad-Request","IIS-Web-Length-Reqd-Access-Denied","Apache-Web-Forbidden-Access-Denied","Apache-Web-Bad-Request","Apache-Web-Length-Reqd-Access-Denied","Squid-Web-Forbidden-Access-Denied","Squid-Web-Bad-Request","Squid-Web-Length-Reqd-Access-Denied")</SingleEvtConstr>
	 <GroupEvtConstr>COUNT (*) &gt;= 5</GroupEvtConstr>
	 <GroupByAttr>reptDevIpAddr,srcIpAddr</GroupByAttr>
       </SubPattern>
    </PatternClause>
    <TriggerEventDisplay>
      <AttrList> phRecvTime,reptDevIpAddr,srcIpAddr,user,httpMethod,uriStem,eventType,httpStatusCode,httpSubStatusCode,reptDevIpAddr,rawEventMsg </AttrList>
    </TriggerEventDisplay>
  </Rule>

  <Rule group="PH_SYS_RULE_Exploits" id="PH_Rule_Web_Server_2" phIncidentCategory="Application">
    <Name>Excessive FTP Client Side Errors</Name>
    <active>true</active>
    <Description>Detects multiple FTP client side errors from the same IP - might indicate an attack from the source IP </Description>
    <CustomerScope groupByEachCustomer="true"> <Include all="true"/> <Exclude/> </CustomerScope>
    <IncidentDef eventType="PH_RULE_EXCESS_FTP_CLIENT_ERR" severity="9">
      <ArgList>
        srcIpAddr = ExcessFTPClientErr.srcIpAddr, destIpAddr = ExcessFTPClientErr.reptDevIpAddr,user = ExcessFTPClientErr.user, incidentCount = ExcessFTPClientErr.COUNT(*)
      </ArgList>
    </IncidentDef>
    <PatternClause window="600">
       <SubPattern displayName="ExcessFTPClientErr" name="ExcessFTPClientErr">
         <SingleEvtConstr> eventType IN ("IIS-FTP-Command-Not-Implemented","IIS-FTP-File-Not-Found","IIS-FTP-Illegal-File")</SingleEvtConstr>
	 <GroupEvtConstr>COUNT (*) &gt;= 5</GroupEvtConstr>
	 <GroupByAttr>reptDevIpAddr,srcIpAddr,user</GroupByAttr>
       </SubPattern>
    </PatternClause>
    <TriggerEventDisplay>
      <AttrList> phRecvTime,reptDevIpAddr,srcIpAddr,user,httpMethod,uriStem,httpStatusCode,httpSubStatusCode,reptDevIpAddr,rawEventMsg </AttrList>
    </TriggerEventDisplay>
  </Rule>

</Rules>
